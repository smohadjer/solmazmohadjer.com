"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),FilterList=function(){function e(t){_classCallCheck(this,e),this.urlIsUpdatable=void 0!==t.urlIsUpdatable&&t.urlIsUpdatable,this.element=t.element,this.filters=[],this.filterNames=this.element.getAttribute("data-filter-names").split(" "),this.initCallback=t.initCallback,this.filtersCallback=t.filtersCallback,this.url=window.location.href,this.lastClass=t.lastClass||"last",this.hiddenClass=t.hiddenClass||"hidden",this.setEventHandlers(),this.setDefaultFilters(this.filterNames),this.updateFiltersfromURL(),this.updateBrowserHistory(),"function"==typeof this.initCallback&&this.initCallback(),this.applyFilters()}return _createClass(e,[{key:"updateBrowserHistory",value:function(){if(this.urlIsUpdatable&&window.history&&window.history.pushState){var e={};e.filters=this.filters.slice(),history.replaceState(e,document.title,this.url)}}},{key:"setDefaultFilters",value:function(e){var t=this;e.forEach(function(e,i){var a=t.getFilterIgnoreValue(e),l=t.getFilterValue(e);console.log("default filters: ",e,l,a),t.filters.push({name:e,value:l,ignoreValue:a})})}},{key:"getFilterIgnoreValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),i=void 0;return t?"SELECT"===t.tagName&&(i=t.getAttribute("data-ignore")):console.warn("No filter with name "+e+" was found in markup!"),i}},{key:"getFilterValue",value:function(e){var t=document.querySelector('[name="'+e+'"]'),i=void 0;return t?i="checkbox"===t.getAttribute("type")?t.checked?t.value:void 0:t.value:console.warn("No filter with name "+e+" was found in markup!"),i}},{key:"updateFiltersfromURL",value:function(){var e=this;this.filterNames.forEach(function(t,i){var a=e.getUrlParameter(t);a&&e.updateFilters({name:t,value:a},!0)})}},{key:"updateFilters",value:function(e,t){var i=this.filters.find(function(t){return t.name===e.name});i&&i.value!==e.value&&(i.value=e.value,this.applyFilters(),t&&this.updateDOM([i]))}},{key:"setEventHandlers",value:function(){var e=this;this.filterNames.forEach(function(t,i){var a=document.querySelector('[name="'+t+'"]');a&&a.addEventListener("change",function(i){console.log(t,e.getFilterValue(t)),e.updateFilters({name:t,value:e.getFilterValue(t)}),e.urlIsUpdatable&&e.updateURL()})}),this.urlIsUpdatable&&window.history&&window.history.pushState&&window.addEventListener("popstate",function(t){if(t.state.filters){for(var i in t.state.filters)e.filters[i]=t.state.filters[i];e.updateDOM(t.state.filters),e.applyFilters()}})}},{key:"updateDOM",value:function(e){for(var t in e){var i=e[t],a=document.querySelector('[name="'+i.name+'"]');a&&("SELECT"===a.tagName&&(a.value=i.value),"INPUT"===a.tagName&&"checkbox"===a.getAttribute("type")&&(a.checked=a.value===i.value))}}},{key:"setFilters",value:function(e){var t=this,i=function(i){t.filters.forEach(function(t,a){t.name===i&&(t.value=e[i])})};for(var a in e)i(a);this.updateDOM(this.filters),this.applyFilters(),this.urlIsUpdatable&&this.updateURL()}},{key:"applyFilters",value:function(){var e=this,t=[],i=this.element.children;if(this.lastClass){var a=this.element.querySelector("."+this.lastClass);a&&a.classList.remove(this.lastClass)}[].concat(_toConsumableArray(i)).forEach(function(i){var a=!0;e.filters.forEach(function(e,t){if(void 0!==e.value&&e.value!==e.ignoreValue&&(!i.hasAttribute("data-filter-"+e.name)||i.getAttribute("data-filter-"+e.name)!==e.value))return a=!1,!1}),a&&t.push(i)}),[].concat(_toConsumableArray(i)).forEach(function(t){t.classList.add(e.hiddenClass)}),0!==t.length?(t.forEach(function(i,a){i.classList.remove(e.hiddenClass),e.lastClass&&a===t.length-1&&i.classList.add(e.lastClass)}),this.element.classList.remove("is-empty")):this.element.classList.add("is-empty"),"function"==typeof this.filtersCallback&&this.filtersCallback()}},{key:"updateURL",value:function(){var e=this;if(window.history&&window.history.pushState){var t={};t.filters=Object.assign({},this.filters),this.filters.forEach(function(t){void 0!==t.value&&0!==t.value.length&&t.value!==t.ignoreValue?e.url=e.updateQueryStringParameter(e.url,t.name,t.value):e.url=e.removeURLParameter(e.url,t.name)}),history.pushState(t,document.title,this.url)}}},{key:"getUrlParameter",value:function(e){var t,i,a=decodeURIComponent(window.location.search.substring(1)),l=a.split("&");for(i=0;i<l.length;i++)if(t=l[i].split("="),t[0]===e)return void 0===t[1]||t[1]}},{key:"updateQueryStringParameter",value:function(e,t,i){var a=new RegExp("([?&])"+t+"=.*?(&|$)","i"),l=e.indexOf("?")!==-1?"&":"?";return e.match(a)?e.replace(a,"$1"+t+"="+i+"$2"):e+l+t+"="+i}},{key:"removeURLParameter",value:function(e,t){var i=e.split("?");if(i.length>=2){for(var a=encodeURIComponent(t)+"=",l=i[1].split(/[&;]/g),r=l.length;r-- >0;)l[r].lastIndexOf(a,0)!==-1&&l.splice(r,1);return e=i[0]+(l.length>0?"?"+l.join("&"):"")}return e}}]),e}(),_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),YTPlayer=function(){function e(t){_classCallCheck(this,e),this.element=t.element,this.cb_playlist_click=t.cb_playlist_click,this.cb_init=t.cb_init,this.playlistId=this.element.getAttribute("data-playlist-id"),this.videoId=this.element.getAttribute("data-video-id"),this.playlistId?this.fetchPlaylist():this.fetchVideo()}return _createClass(e,[{key:"fetchVideo",value:function(){var e=this;gapi.client.youtube.videos.list({part:"snippet",id:this.videoId}).then(function(t){var i=t.result.items[0].snippet;e.showVideo(e.videoId),e.updateVideoInfo(i.title,i.description),"function"==typeof e.cb_init&&e.cb_init()})}},{key:"fetchPlaylist",value:function(){var e=this;gapi.client.youtube.playlistItems.list({part:"snippet",playlistId:this.playlistId,maxResults:50}).then(function(t){for(var i=t.result.items,a=void 0,l=0;l<i.length;l++){var r=i[l].snippet;e.addItem(r),0===l&&(a=r.resourceId.videoId)}e.showVideo(a);var n=e.element.querySelectorAll(".ytplayer-list li")[0];e.updatePlaylist(n),"function"==typeof e.cb_init&&e.cb_init()})}},{key:"updateVideo",value:function(e){var t=e.getAttribute("data-id");this.player.loadVideoById(t)}},{key:"updatePlaylist",value:function(e){var t=e.parentNode,i=t.querySelectorAll("li");Array.prototype.forEach.call(i,function(e,t){e.classList.remove("selected")}),e.classList.add("selected"),this.updateVideoInfo(e.getAttribute("data-title"),e.getAttribute("data-description"))}},{key:"updateVideoInfo",value:function(e,t){var i=this.element.querySelector(".ytplayer-title"),a=this.element.querySelector(".ytplayer-description");i&&(i.innerHTML=e),a&&(a.innerHTML=t)}},{key:"addItem",value:function(e){var t=this,i=this.element.querySelector(".ytplayer-list"),a=e.thumbnails.medium.url,l=e.resourceId.videoId,r='<img src="'+a+'" />',n=document.createElement("li");n.innerHTML=r,n.setAttribute("data-id",l),n.setAttribute("data-title",e.title),n.setAttribute("data-description",e.description),n.addEventListener("click",function(e){var i=e.target.parentNode;t.updatePlaylist(i),t.updateVideo(i),"function"==typeof t.cb_playlist_click&&t.cb_playlist_click(i)}),i.appendChild(n)}},{key:"showVideo",value:function(e){this.player=new YT.Player(this.element.querySelector(".ytplayer-video"),{videoId:e,playerVars:{autoplay:0,rel:0,showinfo:0},events:{}})}}]),e}();
